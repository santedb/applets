<!--
 - Copyright 2021-2024 SanteSuite Contributors (See NOTICE.md for full copyright notices)
 - Copyright (C) 2019 - 2021, Fyfe Software Inc. and the SanteSuite Contributors
 - Portions Copyright (C) 2015-2018 Mohawk College of Applied Arts and Technology
 - 
 - Licensed under the Apache License, Version 2.0 (the "License"); you 
 - may not use this file except in compliance with the License. You may 
 - obtain a copy of the License at 
 - 
 - http://www.apache.org/licenses/LICENSE-2.0 
 - 
 - Unless required by applicable law or agreed to in writing, software
 - distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 - WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the 
 - License for the specific language governing permissions and limitations under 
 - the License.
 -->
<div xmlns="http://www.w3.org/1999/xhtml">
    <div class="actEntryForm w-100">
        <div ng-if="::model.$templateUrl" ng-init="act = model">
            <ng-include src="model.$templateUrl" />
        </div>
        <div class="actInputList">
            <!-- Header Information for the core act-->
            <div class="scroll-sticky">
                <div class="actHeader object-header card">
                    <div class="row">
                        <label class="col-sm-12 col-md-3 col-xl-2 control-label">
                            {{ 'ui.model.act.template' | i18n }}
                        </label>
                        <div class="col-sm-12 col-md-9 col-xl-4 pt-2">
                            <i class="fas fa-fw fa-table-cells"></i>
                            {{ model.templateModel.name }} <span class="badge badge-primary">{{ model.typeConceptModel |
                                concept }}</span>
                        </div>
                        <label class="col-sm-12 col-md-3 col-xl-2 control-label">
                            {{ 'ui.model.act.participation.RecordTarget' | i18n }}
                        </label>
                        <div class="col-sm-12 col-md-9 col-xl-4 pt-2">
                            <i class="fas fa-fw" ng-class="{
                            'fa-person' : model.participation.RecordTarget[0].playerModel.classConcept == 'bacd9c6f-3fa9-481e-9636-37457962804d', 
                            'fa-box': model.participation.RecordTarget[0].playerModel.classConcept == 'b76ff324-b174-40b7-a6ac-d1fdf8e23967'
                        }"></i>
                            {{ model.participation.RecordTarget[0].playerModel.name | name }}
                        </div>
                        <label class="col-sm-12 col-md-3 col-xl-2 control-label">
                            {{ 'ui.model.act.participation.Location' | i18n }}
                        </label>
                        <div class="col-sm-12 col-md-9 col-xl-4 pt-2">
                            <i class="fas fa-fw fa-house-chimney-medical"></i>
                            {{ model.participation.Location[0].playerModel.name | name }}
                        </div>
                        <label class="col-sm-12 col-md-3 col-xl-2 control-label">
                            {{ 'ui.model.act.actTime' | i18n }}
                        </label>
                        <div class="col-sm-12 col-md-9 col-xl-4 pt-2">
                            <div ng-if="model.startTime || model.stopTime">
                                <span ng-if="model.startTime">{{ 'ui.model.act.startTime' | i18n }} <i
                                        class="fas fa-fw fa-clock"></i> {{ model.startTime | extDate: 'M' }}</span>
                                <span ng-if="model.stopTime">{{ 'ui.model.act.stopTime' | i18n }} <i
                                        class="fas fa-fw fa-clock"></i> {{ model.startTime | extDate: 'M' }}</span>
                            </div>
                            <div ng-if="!model.startTime &amp;&amp; !model.stopTime">
                                <i class="fas fa-fw fa-clock"></i> {{ model.actTime | extDate: 'M' }}
                            </div>
                        </div>
                        <label class="col-sm-12 col-md-3 col-xl-2 control-label">
                            {{ 'ui.model.act.participation.Performer' | i18n }}
                        </label>
                        <div class="col-sm-12 col-md-9 col-xl-4 pt-2 d-flex justify-content-between">
                            <span class="mr-2" ng-repeat="aut in model.participation.Authororiginator track by $index">
                                <i class="fas fa-fw fa-user-doctor"></i> {{ aut.playerModel.name | name }}
                            </span>
                            <span class="mr-2" ng-repeat="aut in model.participation.Performer track by $index">
                                <i class="fas fa-fw fa-user-doctor"></i> {{ aut.playerModel.name | name }}
                            </span>
                        </div>
                        <label class="col-sm-12 col-md-3 col-xl-2 control-label" ng-if="model.participation.Informant">
                            {{ 'ui.model.act.participation.Informant' | i18n }}
                        </label>
                        <div class="col-sm-12 col-md-9 col-xl-4 pt-2" ng-if="model.participation.Informant">
                            <i class="fas fa-fw fa-person"></i> {{ model.participation.Informant[0].playerModel.name |
                            name }}
                        </div>
                        <label class="col-sm-12 col-md-3 col-xl-2 control-label"
                            ng-if="model.relationship._HasComponent">
                            {{ 'ui.model.act.participation._HasComponent' | i18n }}
                        </label>
                        <div class="col-sm-12 col-md-9 col-xl-4" ng-if="model.relationship._HasComponent">
                            <i class="fas fa-fw fa-list-check"></i> {{
                            model.relationship._HasComponent.holderModel.typeConceptModel | concept }}
                            <span
                                ng-repeat="dst in model.relationship._HasComponent.holderModel.participation.Destination track by $index">
                                <i class="fas fa-map-pin mr-1"></i> {{ dst.playerModel.name | name }}
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- START CURRENT ENTRY -->
            <ul class="nav nav-tabs">
                <li class="nav-item">
                    <button class="nav-link active" data-toggle="tab" data-target="#currentActionTab"><i class="fas fa-fw fa-list-check"></i> {{ 'ui.model.act.tag.isBackentryFalse' | i18n }}</button>
                </li>
                <li class="nav-item">
                    <button class="nav-link" data-toggle="tab" data-target="#historyActionTab"><i class="fas fa-fw fa-clock-rotate-left"></i> {{ 'ui.model.act.tag.isBackentryTrue' | i18n }}</button>
                </li>
            </ul>
            <div class="tab-content mb-2">
                <div id="currentActionTab" class="tab-pane show active">
                    <ul class="overflow-auto list-group">
                        <li class="list-group-item" ng-repeat="comp in currentActions track by $index">
                            <div class="d-flex justify-content-left">
                                <!-- PROPOSE Should allow users to select an override -->
                                <div class="actProposeControl"
                                    ng-if="comp.targetModel.moodConcept == 'acf7baf2-221f-4bc2-8116-ceb5165be079' || comp.targetModel.relationship.Fulfills[0].targetModel.moodConcept == 'acf7baf2-221f-4bc2-8116-ceb5165be079'">
                                    <label class="checkbox-container">
                                        <input type="checkbox" class="checkbox-control" ng-model="comp.targetModel.isNegated"
                                            id="negate{{$index}}" ng-true-value="false" ng-false-value="true" />
                                        <span></span>
                                    </label>
                                </div>
                                <!-- Render the main act entry content -->
                                <div class="flex-grow-1 actEntryComponent">
                                    <div ng-if="!comp.targetModel.isNegated" ng-init="act = comp.targetModel">
                                        <ng-include src="resolveTemplate(comp.targetModel.templateModel.mnemonic)">
        
                                        </ng-include>
                                    </div>
                                    <div ng-if="comp.targetModel.isNegated">
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text">
                                                    {{ 'ui.model.act.isNegated.reason' | i18n }}
                                                </span>
                                            </div>
                                            <concept-select ng-model="comp.targetModel.isNegated"
                                                concept-set="'ProtocolViolationReason'" required="required" class="form-control"
                                                name="violationReason{{$index}}" />
                                        </div>
                                        <div class="text-danger"
                                            ng-if="ownerForm['violationReason' + $index].$error['required']">
                                            <i class="fas fa-fw fa-exclamation-triangle"></i> {{ 'ui.error.required' |
                                            i18n }}
                                        </div>
                                    </div>
                                </div>
                                <div class="actRemoveItem" ng-if="comp.targetModel._userAdded">
                                    <button type="button" ng-click="model.relationship.HasComponent.splice($index, 1)"
                                        class="btn btn-danger">
                                        <i class="fas fa-fw fa-times-circle"></i> <span class="d-none d-lg-inline">{{
                                            'ui.action.remove' | i18n }}</span>
                                    </button>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
                <div id="historyActionTab" class="tab-pane">
                    <ul class="overflow-auto list-group">
                        <li class="list-group-item" ng-repeat="(tpl, acts) in backEntryActions track by $index">
                            <ng-include src="resolveBackentryTemplate(tpl)"></ng-include>
                        </li>
                    </ul>
                </div>
            </div>
            
            <div class="btn-group float-right dropup">
                <button type="button" class="btn btn-dark dropdown-toggle" data-display="static" data-toggle="dropdown"
                    data-target="#addActionDropdown" aria-haspopup="true" id="btnAddAction">
                    <i class="fas fa-fw fa-plus-circle"></i> {{ 'ui.action.add' | i18n }}
                </button>
                <button ng-repeat="action in actions track by $index" class="btn ml-1" ng-class="action.className"
                    ng-click="doAction(action)" demand="{{action.demand}}" type="{{ action.type || 'button' }}" id="btnActEdit{{action.name}}">
                    <i class="fas fa-fw" ng-class="action.icon"></i>
                    {{ action.label || 'ui.action.' + action.name | i18n }}
                </button>
                <div class="dropdown-menu overflow-auto" id="addActionDropdown">
                    <button class="dropdown-item" type="button" ng-click="addItem(tpl)"
                        ng-repeat="tpl in availableTemplates track by $index">
                        <i ng-class="tpl.icon"></i> {{ tpl.description | i18n }}
                    </button>
                    <div class="dropdown-divider"></div>
                    <div class="dropdown-item">
                        <input type="search" name="_none" ng-model="filterTemplates" class="form-control"
                            placeholder="{{ 'ui.action.search' | i18n }}" />
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>